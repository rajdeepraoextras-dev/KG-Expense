<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KhanaGo - Expense Tracker</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(255, 107, 53, 0.3);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        .header h1 { font-size: 2.5em; margin-bottom: 10px; }
        .header p { font-size: 1.1em; opacity: 0.9; }
        .content { padding: 30px; }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .stat-card {
            background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(255, 107, 53, 0.4);
        }
        .stat-card h3 {
            font-size: 0.9em;
            opacity: 0.9;
            margin-bottom: 10px;
            text-transform: uppercase;
        }
        .stat-card .amount { font-size: 2em; font-weight: bold; margin-bottom: 5px; }
        .stat-card .detail { font-size: 0.85em; opacity: 0.85; }
        .analytics-section {
            background: #fff8f3;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            border: 2px solid #ffe5d9;
        }
        .analytics-section h2 { color: #ff6b35; margin-bottom: 20px; font-size: 1.8em; }
        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .analytics-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(255, 107, 53, 0.15);
            text-align: center;
            border: 2px solid #ffe5d9;
            transition: all 0.3s;
        }
        .analytics-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(255, 107, 53, 0.3);
            border-color: #ff6b35;
        }
        .analytics-icon { font-size: 2.5em; margin-bottom: 15px; }
        .analytics-card h3 { font-size: 0.95em; color: #666; margin-bottom: 12px; }
        .analytics-value { font-size: 1.4em; font-weight: bold; color: #ff6b35; margin-bottom: 8px; }
        .analytics-amount { font-size: 1.8em; font-weight: bold; color: #333; margin-bottom: 5px; }
        .analytics-detail { font-size: 0.85em; color: #999; }
        .breakdown-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
        }
        .breakdown-section {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(255, 107, 53, 0.15);
            border: 2px solid #ffe5d9;
        }
        .breakdown-section h3 { color: #ff6b35; margin-bottom: 20px; font-size: 1.3em; }
        .breakdown-list { display: grid; gap: 15px; }
        .breakdown-item {
            display: flex;
            align-items: center;
            padding: 15px;
            background: #fff8f3;
            border-radius: 8px;
            transition: all 0.3s;
        }
        .breakdown-item:hover {
            background: #ffe5d9;
            transform: translateX(5px);
        }
        .breakdown-label { font-weight: 600; color: #333; min-width: 150px; }
        .breakdown-bar-container {
            flex: 1;
            margin: 0 15px;
            background: #ffe5d9;
            height: 10px;
            border-radius: 5px;
            overflow: hidden;
        }
        .breakdown-bar {
            height: 100%;
            background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
            border-radius: 5px;
            transition: width 0.8s ease;
        }
        .breakdown-stats { text-align: right; min-width: 120px; }
        .breakdown-amount { font-weight: bold; color: #ff6b35; font-size: 1.1em; }
        .breakdown-percent { font-size: 0.85em; color: #999; }
        .form-section {
            background: #fff8f3;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            border: 2px solid #ffe5d9;
        }
        .form-section h2 { color: #ff6b35; margin-bottom: 20px; font-size: 1.5em; }
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        .form-group { display: flex; flex-direction: column; }
        .form-group label { margin-bottom: 8px; color: #333; font-weight: 600; }
        .form-group input, .form-group select, .form-group textarea {
            padding: 12px;
            border: 2px solid #ffe5d9;
            border-radius: 8px;
            font-size: 1em;
            font-family: inherit;
            transition: all 0.3s;
        }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #ff6b35;
            box-shadow: 0 0 0 3px rgba(255, 107, 53, 0.1);
        }
        .form-group textarea { resize: vertical; min-height: 80px; }
        .button-group {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            flex-wrap: wrap;
        }
        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        .btn-primary {
            background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(255, 107, 53, 0.3);
        }
        .btn-primary:hover { 
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 53, 0.4);
        }
        .btn-secondary { 
            background: #6c757d; 
            color: white; 
        }
        .btn-secondary:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }
        .btn-success { 
            background: linear-gradient(135deg, #ff8c42 0%, #ffa500 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(255, 140, 66, 0.3);
        }
        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 140, 66, 0.4);
        }
        .table-section { margin-top: 30px; }
        .table-section h2 { color: #ff6b35; margin-bottom: 20px; font-size: 1.5em; }
        .table-actions {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .table-wrapper {
            overflow-x: auto;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(255, 107, 53, 0.15);
            border: 2px solid #ffe5d9;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            min-width: 1200px;
        }
        thead {
            background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
            color: white;
        }
        th { padding: 15px; text-align: left; font-weight: 600; }
        td { padding: 15px; border-bottom: 1px solid #ffe5d9; }
        tbody tr:hover { background: #fff8f3; }
        .status-badge {
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            display: inline-block;
        }
        .status-approved { background: #d4edda; color: #155724; }
        .status-pending { background: #fff3cd; color: #856404; }
        .btn-small {
            padding: 6px 12px;
            font-size: 0.85em;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-right: 5px;
            transition: all 0.3s;
        }
        .btn-small:hover {
            transform: translateY(-2px);
        }
        .btn-edit { background: #ffc107; color: #333; }
        .btn-delete { background: #dc3545; color: white; }
        .no-data {
            text-align: center;
            padding: 60px 20px;
            color: #999;
            font-size: 1.2em;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üçî KhanaGo Expense Tracker</h1>
            <p>Complete Expense Management System</p>
        </div>

        <div class="content">
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>Total Expenses</h3>
                    <div class="amount" id="totalExpenses">‚Çπ0.00</div>
                    <div class="detail" id="totalCount">0 transactions</div>
                </div>
                <div class="stat-card">
                    <h3>This Month</h3>
                    <div class="amount" id="monthlyExpenses">‚Çπ0.00</div>
                    <div class="detail" id="monthlyPercentage">0%</div>
                </div>
                <div class="stat-card">
                    <h3>Approved</h3>
                    <div class="amount" id="approvedExpenses">‚Çπ0.00</div>
                    <div class="detail" id="approvedPercentage">0%</div>
                </div>
                <div class="stat-card">
                    <h3>Pending</h3>
                    <div class="amount" id="pendingExpenses">‚Çπ0.00</div>
                    <div class="detail" id="pendingPercentage">0%</div>
                </div>
            </div>

            <div class="analytics-section">
                <h2>üìä Analytics</h2>
                <div class="analytics-grid">
                    <div class="analytics-card">
                        <div class="analytics-icon">üìÇ</div>
                        <h3>Top Category</h3>
                        <div class="analytics-value" id="topCategory">-</div>
                        <div class="analytics-amount" id="topCategoryAmount">‚Çπ0.00</div>
                        <div class="analytics-detail" id="topCategoryPercent">0%</div>
                    </div>
                    <div class="analytics-card">
                        <div class="analytics-icon">üë§</div>
                        <h3>Top Payer</h3>
                        <div class="analytics-value" id="topPayer">-</div>
                        <div class="analytics-amount" id="topPayerAmount">‚Çπ0.00</div>
                        <div class="analytics-detail" id="topPayerPercent">0%</div>
                    </div>
                    <div class="analytics-card">
                        <div class="analytics-icon">üí≥</div>
                        <h3>Payment Method</h3>
                        <div class="analytics-value" id="topPayment">-</div>
                        <div class="analytics-amount" id="topPaymentAmount">‚Çπ0.00</div>
                        <div class="analytics-detail" id="topPaymentPercent">0%</div>
                    </div>
                    <div class="analytics-card">
                        <div class="analytics-icon">üìà</div>
                        <h3>Average Transaction</h3>
                        <div class="analytics-value">Per Expense</div>
                        <div class="analytics-amount" id="avgTransaction">‚Çπ0.00</div>
                        <div class="analytics-detail" id="largestTransaction">Largest: ‚Çπ0.00</div>
                    </div>
                </div>

                <div class="breakdown-container">
                    <div class="breakdown-section">
                        <h3>Category Breakdown</h3>
                        <div id="categoryBreakdown" class="breakdown-list">
                            <p style="text-align: center; color: #999;">No data</p>
                        </div>
                    </div>
                    <div class="breakdown-section">
                        <h3>Team Member Expenses</h3>
                        <div id="payerBreakdown" class="breakdown-list">
                            <p style="text-align: center; color: #999;">No data</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h2>‚ûï Add Expense</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Expense ID*</label>
                        <input type="text" id="expenseId" placeholder="EXP031">
                    </div>
                    <div class="form-group">
                        <label>Date*</label>
                        <input type="date" id="date">
                    </div>
                    <div class="form-group">
                        <label>Category*</label>
                        <select id="category">
                            <option value="">Select</option>
                            <option value="Software">Software</option>
                            <option value="Hardware">Hardware</option>
                            <option value="Marketing">Marketing</option>
                            <option value="Operations">Operations</option>
                            <option value="Travel">Travel</option>
                            <option value="Equipment">Equipment</option>
                            <option value="Miscellaneous">Miscellaneous</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Amount (‚Çπ)*</label>
                        <input type="number" id="amount" step="0.01" placeholder="0.00">
                    </div>
                    <div class="form-group">
                        <label>Who Paid*</label>
                        <select id="whoPaid">
                            <option value="">Select</option>
                            <option value="Rajdeep Rao">Rajdeep Rao</option>
                            <option value="Abhishek Rao">Abhishek Rao</option>
                            <option value="Arvind Singh">Arvind Singh</option>
                            <option value="Harshwardhan">Harshwardhan</option>
                            <option value="Om Ji">Om Ji</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Payment*</label>
                        <select id="payment">
                            <option value="">Select</option>
                            <option value="UPI">UPI</option>
                            <option value="Cash">Cash</option>
                            <option value="Credit Card">Credit Card</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Vendor</label>
                        <input type="text" id="vendor" placeholder="Vendor name">
                    </div>
                    <div class="form-group">
                        <label>Approved By*</label>
                        <select id="approvedBy">
                            <option value="">Select</option>
                            <option value="Rajdeep Rao">Rajdeep Rao</option>
                            <option value="Abhishek Rao">Abhishek Rao</option>
                            <option value="Arvind Singh">Arvind Singh</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Status*</label>
                        <select id="status">
                            <option value="">Select</option>
                            <option value="Approved">Approved</option>
                            <option value="Pending">Pending</option>
                        </select>
                    </div>
                </div>
                <div class="form-grid">
                    <div class="form-group" style="grid-column: 1 / -1;">
                        <label>Description*</label>
                        <textarea id="description" placeholder="Details..."></textarea>
                    </div>
                </div>
                <div class="button-group">
                    <button class="btn btn-secondary" id="clearBtn">Clear</button>
                    <button class="btn btn-primary" id="addBtn">Add Expense</button>
                </div>
            </div>

            <div class="table-section">
                <h2>üìã All Expenses</h2>
                <div class="table-actions">
                    <button class="btn btn-secondary" id="exportBtn">üì• Export CSV</button>
                    <button class="btn btn-secondary" id="clearAllBtn">üóëÔ∏è Clear All</button>
                </div>
                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Date</th>
                                <th>Category</th>
                                <th>Description</th>
                                <th>Amount</th>
                                <th>Who Paid</th>
                                <th>Payment</th>
                                <th>Vendor</th>
                                <th>Approved By</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="tbody">
                            <tr><td colspan="11" class="no-data">Loading data...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

<script>
// Pre-loaded expenses (only used if no data exists in localStorage)
let defaultExpenses = [
{expenseId:"EXP001",date:"2025-10-30",category:"Software",description:"Renflair App : 1 Month",amount:1602,whoPaid:"Abhishek Rao",payment:"UPI",vendor:"Renflair",approvedBy:"Rajdeep Rao",status:"Approved"},
{expenseId:"EXP002",date:"2025-10-31",category:"Software",description:"Razorpay Activation Fees",amount:210,whoPaid:"Rajdeep Rao",payment:"UPI",vendor:"Razorpay",approvedBy:"Abhishek Rao",status:"Approved"},
{expenseId:"EXP003",date:"2025-10-31",category:"Software",description:"Proton Drive : 200 GB",amount:140,whoPaid:"Rajdeep Rao",payment:"UPI",vendor:"Proton",approvedBy:"Abhishek Rao",status:"Approved"},
{expenseId:"EXP004",date:"2025-10-31",category:"Software",description:"Razorpay Activation Fees",amount:210,whoPaid:"Rajdeep Rao",payment:"UPI",vendor:"Razorpay",approvedBy:"Abhishek Rao",status:"Approved"},
{expenseId:"EXP005",date:"2025-10-31",category:"Software",description:"Business Mail : Hostinger 1 Month",amount:50,whoPaid:"Rajdeep Rao",payment:"UPI",vendor:"Hostinger",approvedBy:"Abhishek Rao",status:"Approved"},
{expenseId:"EXP006",date:"2025-10-31",category:"Software",description:"Domain: KhanaGo.Shop 1 Year",amount:120,whoPaid:"Rajdeep Rao",payment:"UPI",vendor:"Hostinger",approvedBy:"Abhishek Rao",status:"Approved"},
{expenseId:"EXP007",date:"2025-11-01",category:"Software",description:"Google Developer Console : Lifetime",amount:2300,whoPaid:"Rajdeep Rao",payment:"UPI",vendor:"Google",approvedBy:"Abhishek Rao",status:"Approved"},
{expenseId:"EXP008",date:"2025-11-03",category:"Software",description:"Canva Business : 1 Month",amount:650,whoPaid:"Rajdeep Rao",payment:"UPI",vendor:"Canva",approvedBy:"Abhishek Rao",status:"Approved"},
{expenseId:"EXP009",date:"2025-11-03",category:"Marketing",description:"Flyer Sticker : 100 Pcs",amount:1000,whoPaid:"Arvind Singh",payment:"UPI",vendor:"CJ Prints",approvedBy:"Abhishek Rao",status:"Approved"},
{expenseId:"EXP010",date:"2025-11-03",category:"Software",description:"Added to Meta Ads Account For Trial",amount:210,whoPaid:"Rajdeep Rao",payment:"UPI",vendor:"Meta",approvedBy:"Abhishek Rao",status:"Approved"},
{expenseId:"EXP011",date:"2025-11-05",category:"Equipment",description:"Business Sim",amount:350,whoPaid:"Abhishek Rao",payment:"UPI",vendor:"Local Vendor",approvedBy:"Abhishek Rao",status:"Approved"},
{expenseId:"EXP012",date:"2025-11-10",category:"Marketing",description:"Tshirt Print",amount:1750,whoPaid:"Abhishek Rao",payment:"UPI",vendor:"CC",approvedBy:"Abhishek Rao",status:"Approved"},
{expenseId:"EXP013",date:"2025-11-11",category:"Marketing",description:"Tshirt Print",amount:550,whoPaid:"Rajdeep Rao",payment:"UPI",vendor:"CC",approvedBy:"Abhishek Rao",status:"Approved"},
{expenseId:"EXP014",date:"2025-11-12",category:"Marketing",description:"Menu Print",amount:220,whoPaid:"Rajdeep Rao",payment:"UPI",vendor:"CJ Prints",approvedBy:"Abhishek Rao",status:"Approved"},
{expenseId:"EXP015",date:"2025-11-13",category:"Marketing",description:"Menu Print",amount:400,whoPaid:"Arvind Singh",payment:"UPI",vendor:"CJ Prints",approvedBy:"Abhishek Rao",status:"Approved"},
{expenseId:"EXP016",date:"2025-11-13",category:"Miscellaneous",description:"Company Incorporation",amount:4812,whoPaid:"Rajdeep Rao",payment:"UPI",vendor:"RK",approvedBy:"Abhishek Rao",status:"Approved"},
{expenseId:"EXP017",date:"2025-11-13",category:"Miscellaneous",description:"Company Incorporation",amount:4812,whoPaid:"Abhishek Rao",payment:"UPI",vendor:"RK",approvedBy:"Abhishek Rao",status:"Approved"},
{expenseId:"EXP018",date:"2025-11-13",category:"Miscellaneous",description:"Company Incorporation",amount:4812,whoPaid:"Arvind Singh",payment:"UPI",vendor:"RK",approvedBy:"Abhishek Rao",status:"Approved"},
{expenseId:"EXP019",date:"2025-11-13",category:"Miscellaneous",description:"Company Incorporation",amount:4812,whoPaid:"Harshwardhan",payment:"UPI",vendor:"RK",approvedBy:"Abhishek Rao",status:"Approved"},
{expenseId:"EXP020",date:"2025-11-13",category:"Miscellaneous",description:"Company Incorporation",amount:4812,whoPaid:"Om Ji",payment:"UPI",vendor:"RK",approvedBy:"Abhishek Rao",status:"Approved"},
{expenseId:"EXP021",date:"2025-11-14",category:"Marketing",description:"Tshirt Print",amount:550,whoPaid:"Rajdeep Rao",payment:"UPI",vendor:"CC",approvedBy:"Abhishek Rao",status:"Approved"},
{expenseId:"EXP022",date:"2025-11-14",category:"Travel",description:"Tshirt Rapido Delivery",amount:70,whoPaid:"Rajdeep Rao",payment:"UPI",vendor:"Rapido",approvedBy:"Abhishek Rao",status:"Approved"},
{expenseId:"EXP023",date:"2025-11-15",category:"Miscellaneous",description:"LLP Name Form",amount:200,whoPaid:"Rajdeep Rao",payment:"UPI",vendor:"MCA",approvedBy:"Abhishek Rao",status:"Approved"},
{expenseId:"EXP024",date:"2025-11-16",category:"Marketing",description:"Hata_Vlogs Story",amount:150,whoPaid:"Rajdeep Rao",payment:"UPI",vendor:"Amit Kumar",approvedBy:"Abhishek Rao",status:"Approved"},
{expenseId:"EXP025",date:"2025-11-17",category:"Software",description:"Sms Credit: KhanaGo App",amount:250,whoPaid:"Abhishek Rao",payment:"UPI",vendor:"Renflair",approvedBy:"Abhishek Rao",status:"Approved"},
{expenseId:"EXP026",date:"2025-11-20",category:"Marketing",description:"Pamphlet : 1000",amount:1000,whoPaid:"Rajdeep Rao",payment:"UPI",vendor:"CJ Prints",approvedBy:"Abhishek Rao",status:"Approved"},
{expenseId:"EXP027",date:"2025-11-20",category:"Marketing",description:"V Shape : 30",amount:2400,whoPaid:"Rajdeep Rao",payment:"UPI",vendor:"CJ Prints",approvedBy:"Abhishek Rao",status:"Approved"},
{expenseId:"EXP028",date:"2025-11-20",category:"Marketing",description:"Shiva Sticker",amount:200,whoPaid:"Rajdeep Rao",payment:"UPI",vendor:"CJ Prints",approvedBy:"Abhishek Rao",status:"Approved"},
{expenseId:"EXP029",date:"2025-11-20",category:"Marketing",description:"Circle Sticker",amount:1080,whoPaid:"Rajdeep Rao",payment:"UPI",vendor:"CJ Prints",approvedBy:"Abhishek Rao",status:"Approved"},
{expenseId:"EXP030",date:"2025-11-20",category:"Software",description:"LinkTree Subscription",amount:650,whoPaid:"Rajdeep Rao",payment:"UPI",vendor:"LinkTree",approvedBy:"Abhishek Rao",status:"Approved"}
];

let expenses = [];
let editIndex = -1;

// FIXED: Load data from localStorage or use default data
window.onload = function() {
    document.getElementById('date').value = new Date().toISOString().split('T')[0];
    
    // Load from localStorage if it exists, otherwise use preloaded data
    const saved = localStorage.getItem('expenses');
    if(saved) {
        expenses = JSON.parse(saved);
    } else {
        // First time load - use the default 30 expenses
        expenses = defaultExpenses;
        save(); // Save the default data
    }
    
    render();
    
    document.getElementById('addBtn').onclick = function() {
        const e = {
            expenseId: document.getElementById('expenseId').value.trim(),
            date: document.getElementById('date').value,
            category: document.getElementById('category').value,
            description: document.getElementById('description').value.trim(),
            amount: parseFloat(document.getElementById('amount').value),
            whoPaid: document.getElementById('whoPaid').value,
            payment: document.getElementById('payment').value,
            vendor: document.getElementById('vendor').value.trim(),
            approvedBy: document.getElementById('approvedBy').value,
            status: document.getElementById('status').value
        };
        
        if(!e.expenseId||!e.date||!e.category||!e.description||!e.amount||!e.whoPaid||!e.payment||!e.approvedBy||!e.status) {
            alert('Fill all required fields!');
            return;
        }
        
        if(editIndex === -1) {
            expenses.push(e);
            alert('‚úÖ Added!');
        } else {
            expenses[editIndex] = e;
            editIndex = -1;
            alert('‚úÖ Updated!');
        }
        save();
        render();
        clear();
    };
    
    document.getElementById('clearBtn').onclick = clear;
    
    document.getElementById('exportBtn').onclick = function() {
        if(!expenses.length) { alert('No data!'); return; }
        const csv = [
            'ID,Date,Category,Description,Amount,WhoPaid,Payment,Vendor,ApprovedBy,Status',
            ...expenses.map(e => `${e.expenseId},${e.date},${e.category},"${e.description}",${e.amount},${e.whoPaid},${e.payment},${e.vendor},${e.approvedBy},${e.status}`)
        ].join('\n');
        const blob = new Blob([csv], {type:'text/csv'});
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = 'expenses.csv';
        a.click();
        alert('‚úÖ Exported!');
    };
    
    document.getElementById('clearAllBtn').onclick = function() {
        if(confirm('Delete all data?')) {
            expenses = [];
            save();
            render();
            alert('‚úÖ Cleared!');
        }
    };
};

function save() {
    localStorage.setItem('expenses', JSON.stringify(expenses));
}

function clear() {
    document.getElementById('expenseId').value = '';
    document.getElementById('category').value = '';
    document.getElementById('description').value = '';
    document.getElementById('amount').value = '';
    document.getElementById('whoPaid').value = '';
    document.getElementById('payment').value = '';
    document.getElementById('vendor').value = '';
    document.getElementById('approvedBy').value = '';
    document.getElementById('status').value = '';
    document.getElementById('date').value = new Date().toISOString().split('T')[0];
}

function render() {
    const tbody = document.getElementById('tbody');
    if(!expenses.length) {
        tbody.innerHTML = '<tr><td colspan="11" class="no-data">No data</td></tr>';
        updateStats();
        return;
    }
    
    tbody.innerHTML = expenses.map((e,i) => `
        <tr>
            <td><b>${e.expenseId}</b></td>
            <td>${e.date}</td>
            <td>${e.category}</td>
            <td>${e.description}</td>
            <td><b>‚Çπ${e.amount.toFixed(2)}</b></td>
            <td>${e.whoPaid}</td>
            <td>${e.payment}</td>
            <td>${e.vendor||'-'}</td>
            <td>${e.approvedBy}</td>
            <td><span class="status-badge status-${e.status.toLowerCase()}">${e.status}</span></td>
            <td>
                <button class="btn-small btn-edit" onclick="edit(${i})">‚úèÔ∏è</button>
                <button class="btn-small btn-delete" onclick="del(${i})">üóëÔ∏è</button>
            </td>
        </tr>
    `).join('');
    
    updateStats();
}

function edit(i) {
    const e = expenses[i];
    document.getElementById('expenseId').value = e.expenseId;
    document.getElementById('date').value = e.date;
    document.getElementById('category').value = e.category;
    document.getElementById('description').value = e.description;
    document.getElementById('amount').value = e.amount;
    document.getElementById('whoPaid').value = e.whoPaid;
    document.getElementById('payment').value = e.payment;
    document.getElementById('vendor').value = e.vendor;
    document.getElementById('approvedBy').value = e.approvedBy;
    document.getElementById('status').value = e.status;
    editIndex = i;
    window.scrollTo(0,0);
}

function del(i) {
    if(confirm('Delete?')) {
        expenses.splice(i,1);
        save();
        render();
        alert('‚úÖ Deleted!');
    }
}

function updateStats() {
    if(!expenses.length) {
        document.getElementById('totalExpenses').textContent = '‚Çπ0.00';
        document.getElementById('totalCount').textContent = '0 transactions';
        document.getElementById('monthlyExpenses').textContent = '‚Çπ0.00';
        document.getElementById('monthlyPercentage').textContent = '0%';
        document.getElementById('approvedExpenses').textContent = '‚Çπ0.00';
        document.getElementById('approvedPercentage').textContent = '0%';
        document.getElementById('pendingExpenses').textContent = '‚Çπ0.00';
        document.getElementById('pendingPercentage').textContent = '0%';
        document.getElementById('topCategory').textContent = '-';
        document.getElementById('topCategoryAmount').textContent = '‚Çπ0.00';
        document.getElementById('topCategoryPercent').textContent = '0%';
        document.getElementById('topPayer').textContent = '-';
        document.getElementById('topPayerAmount').textContent = '‚Çπ0.00';
        document.getElementById('topPayerPercent').textContent = '0%';
        document.getElementById('topPayment').textContent = '-';
        document.getElementById('topPaymentAmount').textContent = '‚Çπ0.00';
        document.getElementById('topPaymentPercent').textContent = '0%';
        document.getElementById('avgTransaction').textContent = '‚Çπ0.00';
        document.getElementById('largestTransaction').textContent = 'Largest: ‚Çπ0.00';
        document.getElementById('categoryBreakdown').innerHTML = '<p style="text-align:center;color:#999">No data</p>';
        document.getElementById('payerBreakdown').innerHTML = '<p style="text-align:center;color:#999">No data</p>';
        return;
    }
    
    const total = expenses.reduce((s,e)=>s+e.amount,0);
    const approved = expenses.filter(e=>e.status==='Approved').reduce((s,e)=>s+e.amount,0);
    const pending = expenses.filter(e=>e.status==='Pending').reduce((s,e)=>s+e.amount,0);
    const now = new Date();
    const monthly = expenses.filter(e=>{
        const d = new Date(e.date);
        return d.getMonth()===now.getMonth() && d.getFullYear()===now.getFullYear();
    }).reduce((s,e)=>s+e.amount,0);
    
    document.getElementById('totalExpenses').textContent = '‚Çπ'+total.toFixed(2);
    document.getElementById('totalCount').textContent = expenses.length+' transactions';
    document.getElementById('monthlyExpenses').textContent = '‚Çπ'+monthly.toFixed(2);
    document.getElementById('monthlyPercentage').textContent = ((monthly/total)*100).toFixed(1)+'%';
    document.getElementById('approvedExpenses').textContent = '‚Çπ'+approved.toFixed(2);
    document.getElementById('approvedPercentage').textContent = ((approved/total)*100).toFixed(1)+'%';
    document.getElementById('pendingExpenses').textContent = '‚Çπ'+pending.toFixed(2);
    document.getElementById('pendingPercentage').textContent = ((pending/total)*100).toFixed(1)+'%';
    
    const cats = {};
    const payers = {};
    const payments = {};
    expenses.forEach(e => {
        cats[e.category] = (cats[e.category]||0) + e.amount;
        payers[e.whoPaid] = (payers[e.whoPaid]||0) + e.amount;
        payments[e.payment] = (payments[e.payment]||0) + e.amount;
    });
    
    const topCat = Object.entries(cats).sort((a,b)=>b[1]-a[1])[0];
    const topPayer = Object.entries(payers).sort((a,b)=>b[1]-a[1])[0];
    const topPayment = Object.entries(payments).sort((a,b)=>b[1]-a[1])[0];
    
    if(topCat) {
        document.getElementById('topCategory').textContent = topCat[0];
        document.getElementById('topCategoryAmount').textContent = '‚Çπ'+topCat[1].toFixed(2);
        document.getElementById('topCategoryPercent').textContent = ((topCat[1]/total)*100).toFixed(1)+'%';
    }
    if(topPayer) {
        document.getElementById('topPayer').textContent = topPayer[0];
        document.getElementById('topPayerAmount').textContent = '‚Çπ'+topPayer[1].toFixed(2);
        document.getElementById('topPayerPercent').textContent = ((topPayer[1]/total)*100).toFixed(1)+'%';
    }
    if(topPayment) {
        document.getElementById('topPayment').textContent = topPayment[0];
        document.getElementById('topPaymentAmount').textContent = '‚Çπ'+topPayment[1].toFixed(2);
        document.getElementById('topPaymentPercent').textContent = ((topPayment[1]/total)*100).toFixed(1)+'%';
    }
    
    document.getElementById('avgTransaction').textContent = '‚Çπ'+(total/expenses.length).toFixed(2);
    document.getElementById('largestTransaction').textContent = 'Largest: ‚Çπ'+Math.max(...expenses.map(e=>e.amount)).toFixed(2);
    
    const catHTML = Object.entries(cats).sort((a,b)=>b[1]-a[1]).map(([n,a])=>{
        const p = ((a/total)*100).toFixed(1);
        return `<div class="breakdown-item">
            <div class="breakdown-label">${n}</div>
            <div class="breakdown-bar-container"><div class="breakdown-bar" style="width:${p}%"></div></div>
            <div class="breakdown-stats">
                <div class="breakdown-amount">‚Çπ${a.toFixed(2)}</div>
                <div class="breakdown-percent">${p}%</div>
            </div>
        </div>`;
    }).join('');
    document.getElementById('categoryBreakdown').innerHTML = catHTML;
    
    const payerHTML = Object.entries(payers).sort((a,b)=>b[1]-a[1]).map(([n,a])=>{
        const p = ((a/total)*100).toFixed(1);
        return `<div class="breakdown-item">
            <div class="breakdown-label">üë§ ${n}</div>
            <div class="breakdown-bar-container"><div class="breakdown-bar" style="width:${p}%"></div></div>
            <div class="breakdown-stats">
                <div class="breakdown-amount">‚Çπ${a.toFixed(2)}</div>
                <div class="breakdown-percent">${p}%</div>
            </div>
        </div>`;
    }).join('');
    document.getElementById('payerBreakdown').innerHTML = payerHTML;
}
</script>
</body>
</html>
